<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>P1 reader</title></head><body><script>// Author: Edwin Glaser// -------- Only for private usage -----------// Date Nov. 2022// HomeWizard P1 // active_power_l1_w : // active_power_l2_w : // active_power_l3_w : // active_power_w : // gas_timestamp : // meter_model: // smr_version: // total_gas_m3: // total_power_export_t1_kwh: // total_power_export_t2_kwh: // total_power_import_t1_kwh : // total_power_import_t2_kwh : // wifi_ssid : "..."// wifi_strength : 100document.getElementById('IP').value=' 192.168.2.45';var ip ;async function wrapper(){ console.log('start'); await waitInterval( meter, 1000); // await waitInterval(second, 1000); console.log('finish')};function run(){ ip=document.getElementById('IP').value; if (ip !=''){ wrapper()}}async function meter(i){ let url='http://' + ip + '/api/v1/data'; let response=await fetch(url); if (response.ok){ // if HTTP-status is 200-299 // get the response body (the method explained below) let json=await response.json(); document.getElementById('WifiSSID').innerHTML=json.wifi_ssid; document.getElementById('WifiStrength').innerHTML=json.wifi_strength; //meter_model //smr_version: document.getElementById('P1').innerHTML=json.active_power_l1_w; if(json.active_power_l2_w){ document.getElementById('P2').innerHTML=json.active_power_l2_w} else{ document.getElementById('P2').innerHTML='';} if(json.active_power_l3_w){ document.getElementById('P3').innerHTML=json.active_power_l3_w}else{ document.getElementById('P3').innerHTML='';}; document.getElementById('PT').innerHTML=json.active_power_w; // total_power_export_t1_kwh: document.getElementById('ET1').innerHTML=json.total_power_export_t1_kwh; // total_power_export_t2_kwh: document.getElementById('ET2').innerHTML=json.total_power_export_t2_kwh; // total_power_import_t1_kwh : document.getElementById('IT1').innerHTML=json.total_power_import_t1_kwh; // total_power_import_t2_kwh : document.getElementById('IT2').innerHTML=json.total_power_import_t2_kwh; //gas_timestamp GTS if(json.gas_timestamp){ var date=new Date(json.gas_timestamp); // console.log(date.getTime()) // console.log(date) let time=date.getTime(); document.getElementById('GTS').innerHTML=date; //time; //total_gas_m3 G0 document.getElementById('G0').innerHTML=json.total_gas_m3;} return i==60;} else{ alert("HTTP-Error: " + response.status);}}async function waitInterval(callback, ms){ return new Promise(resolve=>{ let iteration=0; const interval=setInterval(async ()=>{ if (await callback(iteration, interval) ){ resolve(); clearInterval(interval); return true;} iteration++;}, ms);})}</script><div><label for="IP">IP:</label><input type="text" id="IP" name="IP" required minlength="7" maxlength="15" size="15" ><input id="Scan" type="button" value="Start" onclick="run()"></div><br><h0>Wifi Ssid:<span id=WifiSSID></span></h0><br><h0>Wifi Strength:<span id=WifiStrength>0</span>%</h0><br><h1>Fase 1 (W):<span id=P1>0</span></h1><h1>Fase 2 (W):<span id=P2>0</span></h1><h1>Fase 3 (W):<span id=P3>0</span></h1><h1>Totaal (W):<span id=PT>0</span></h1><br><h1>Export T1 (kWh) :<span id=ET1>0</span></h1><h1>Export T2 (kWh) :<span id=ET2>0</span></h1><h1>Import T1 (kWh) :<span id=IT1>0</span></h1><h1>Import T2 (kWh) :<span id=IT2>0</span></h1><br><h0>Gas Time :<span id=GTS>0</span></h0><h1>Gas (m3) :<span id=G0>0</span></h1></body></html>